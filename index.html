<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css' rel='stylesheet'/>
    <link rel="stylesheet" href="style.css">
    <title>แบบสำรวจสิ่งแวดล้อม</title>
</head>
<body>
    <form method="post" accept-charset="UTF-8" autocomplete="off" name="แบบสำรวจผู้แทน">
        <div id="content">
        <div class="container">

            <div class="main_title"><h1><b>แบบสำรวจสิ่งแวดล้อม</b></h1></div>

            <div class="title">
                <div class="sub_title">
                    <span for="หน่วยงาน"><b>หน่วยงาน :</b></span>
                    <input class="input_sec" style="width: 80px;" placeholder="เลือกหน่วยงาน" list="หน่วยงาน" required autocomplete="off" id="ชื่อหน่วยงาน" name="ชื่อหน่วยงาน">
                        <datalist id="หน่วยงาน">
                        <option value="รส.2">
                        <option value="รส.3">
                        <option value="รส.4">
                        <option value="รส.5"> 
                        <option value="รส.6">
                        <option value="รส.7"> 
                        <option value="รส.8">
                        <option value="รส.9">
                        <option value="รส.11">
                        <option value="รส.13">
                        <option value="รส.15">
                        <option value="รส.16">
                        <option value="รส.17">
                        <option value="คท.">
                        <option value="คผ.">
                        <option value="คสร."> 
                        <option value="คอ.">
                        <option value="คต.">
                        <option value="ผสท.กปส.3">
                        <option value="ผสอ.">
                        <option value="คตป.">
                        <option value="คบต.">
                        <option value="กตส.1">
                        <option value="กตส.2">
                        <option value="ซท.1">
                        <option value="ซท.2">
                        <option value="ซท.3">
                        <option value="ปภ."> 
                        </datalist>
                </div>

                <div class="sub_title">
                    <span for="date"><b>วันที่ทำการสำรวจ :</b></span>
                    <input class="input_sec" type="date" name="วันที่ทำการสำรวจ" required>
                </div>
              
               <div class="sub_title">
                    <span for="ชื่อผู้สำรวจ"><b>ชื่อผู้สำรวจ :</b></span>
                    <input class="input_sec" type="text" name="ชื่อผู้สำรวจ" style="width: 110px;"  required>
                </div>

                <div class="sub_title">
                    <span for="ตำแหน่ง"><b>ตำแหน่ง :</b></span>
                    <input class="input_sec" style="width: 100px;" type="text" name="ตำแหน่ง" required>
                </div>
                
            </div>
            <br>
        
            <table>
                <tr>
                    <th rowspan="2"><center>รายละเอียดการสำรวจ</center></th>
                    <th colspan="3"><center>ผลการสำรวจ</center></th>
                </tr>
                <tr>
                    <th>ผ่าน</th>
                    <th>ไม่ผ่าน</th>
                    <th>ไม่มี</th>   
                </tr>

                <tr>
                   <td colspan="4" style="color: rgb(32, 118, 247);">1. ความสะอาด</td> 
                </tr>

                <tr>
                    <td>1.1 อาคารและบริเวณโดยรอบสะอาด</td>
                    <td class="in"><input type="radio"  name="1.1 อาคารและบริเวณโดยรอบสะอาด" value="ผ่าน"></td>
                    <td class="in"><input type="radio"  name="1.1 อาคารและบริเวณโดยรอบสะอาด" value="ไม่ผ่าน"></td>
                    <td></td>
                </tr>
                <tr>
                    <td>1.2 อุปกรณ์ของใช้สะอาดและอยู่ในสภาพดี</td>
                    <td class="in"><input type="radio" name="1.2 อุปกรณ์ของใช้สะอาดและอยู่ในสภาพดี" value="ผ่าน"></td>
                    <td class="in"><input type="radio" name="1.2 อุปกรณ์ของใช้สะอาดและอยู่ในสภาพดี" value="ไม่ผ่าน"></td>
                    <td></td>
                </tr>
                <tr>
                    <td>1.3 มีการจัดวางสิ่งของเป็นระเบียบเรียบร้อย</td>
                    <td class="in"><input type="radio" name="1.3 มีการจัดวางสิ่งของเป็นระเบียบเรียบร้อย" value="ผ่าน"></td>
                    <td class="in"><input type="radio" name="1.3 มีการจัดวางสิ่งของเป็นระเบียบเรียบร้อย" value="ไม่ผ่าน"></td>
                    <td></td>
                </tr>

                <tr>
                    <td colspan="4" style="color: rgb(32, 118, 247);">1. ขยะ</td> 
                </tr>
                <tr>
                    <td>2.1 ที่รองรับขยะถูกหลักสุขาภิบาล</td>
                    <td class="in"><input type="radio" name="2.1 ที่รองรับขยะถูกหลักสุขาภิบาล" value="ผ่าน"></td>
                    <td class="in"><input type="radio" name="2.1 ที่รองรับขยะถูกหลักสุขาภิบาล" value="ไม่ผ่าน"></td>
                    <td></td>
                </tr>
                <tr>
                    <td>2.2 ที่รองรับขยะมีจำนวนเพียงพอ</td>
                    <td class="in"><input type="radio" name="2.2 ที่รองรับขยะมีจำนวนเพียงพอ" value="ผ่าน"></td>
                    <td class="in"><input type="radio" name="2.2 ที่รองรับขยะมีจำนวนเพียงพอ" value="ไม่ผ่าน"></td>
                    <td></td>
                </tr>
                <tr>
                    <td>2.3 มีการคัดแยกประเภทขยะ</td>
                    <td class="in"><input type="radio" name="2.3 มีการคัดแยกประเภทขยะ" value="ผ่าน"></td>
                    <td class="in"><input type="radio" name="2.3 มีการคัดแยกประเภทขยะ" value="ไม่ผ่าน"></td>
                    <td></td>
                </tr>
                <tr>
                    <td>2.4 มีการคัดแยกประเภทขยะ</td>
                    <td class="in"><input type="radio" name="2.4 มีการคัดแยกประเภทขยะ" value="ผ่าน"></td>
                    <td class="in"><input type="radio" name="2.4 มีการคัดแยกประเภทขยะ" value="ไม่ผ่าน"></td>
                    <td></td>
                </tr>
                <tr>
                    <td>2.5 ขยะไม่ส่งกลิ่นเหม็นรบกวน</td>
                    <td class="in"><input type="radio" name="2.5 ขยะไม่ส่งกลิ่นเหม็นรบกวน" value="ผ่าน"></td>
                    <td class="in"><input type="radio" name="2.5 ขยะไม่ส่งกลิ่นเหม็นรบกวน" value="ไม่ผ่าน"></td>
                    <td></td>
                </tr>
                <tr>
                    <td colspan="4" style="color: rgb(32, 118, 247);">3. น้ำเสีย</td> 
                </tr>
                <tr>
                    <td>3.1 ท่อ/ รางระบายน้ำอยู่ในสภาพดี ไม่อุดตัน</td>
                    <td class="in"><input type="radio" name="3.1 ท่อ/ รางระบายน้ำอยู่ในสภาพดี ไม่อุดตัน" value="ผ่าน"></td>
                    <td class="in"><input type="radio" name="3.1 ท่อ/ รางระบายน้ำอยู่ในสภาพดี ไม่อุดตัน" value="ไม่ผ่าน"></td>
                    <td></td>
                </tr>
                <tr>
                    <td>3.2 มีการบำบัดน้ำเสียขั้นต้น เช่น ระบบบำบัดน้ำเสีย ถังดักไขมัน</td>
                    <td class="in"><input type="radio" name="3.2 มีการบำบัดน้ำเสียขั้นต้น เช่น ระบบบำบัดน้ำเสีย ถังดักไขมัน" value="ผ่าน"></td>
                    <td class="in"><input type="radio" name="3.2 มีการบำบัดน้ำเสียขั้นต้น เช่น ระบบบำบัดน้ำเสีย ถังดักไขมัน" value="ไม่ผ่าน"></td>
                    <td class="in"><input type="radio" name="3.2 มีการบำบัดน้ำเสียขั้นต้น เช่น ระบบบำบัดน้ำเสีย ถังดักไขมัน" value="ไม่มี"></td>
                </tr>
                <tr>
                    <td>3.3 ระบบบำบัดน้ำเสียใช้งานได้ปกติ</td>
                    <td class="in"><input type="radio" name="3.3 ระบบบำบัดน้ำเสียใช้งานได้ปกติ" value="ผ่าน"></td>
                    <td class="in"><input type="radio" name="3.3 ระบบบำบัดน้ำเสียใช้งานได้ปกติ" value="ไม่ผ่าน"></td>
                    <td class="in"><input type="radio" name="3.3 ระบบบำบัดน้ำเสียใช้งานได้ปกติ" value="ไม่มี"></td>
                </tr>
            </table>

            <div style="margin-top: 15px;">
                <span for="Upload File">แนบไฟล์รูป : </span>
                <input id="files" type="file" id="files" multiple>
            </div>
           
            <div><input class="suggest_input" placeholder="ข้อเสนอแนะ" type="text"  name="ข้อเสนอแนะ" ></div>

            <div class="box_button">
                <button class="button" type="submit" name="submit" id="submit" onclick="getFiles" value="submit">ส่งแบบสำรวจ</button>
                <button class="button" type="button" name="button" id="print" onclick="window.print();"><p>Print</p><p>(เปิดผ่าน Browser)</p></button>
            </div>
           
           
         
            
            <p id="demo"></p>

        </div>  
        </div>
        

    </form>
</body>
<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwOCAlaO3piMuKSYZp9Msj4WN5pCmPfT2tyuzRdiih8nG3wT7VqdWd7dfHsAuBZj0r5-g/exec';
    const form = document.forms['ผลลงทะเบียน'];
    
    form.addEventListener('submit', e => {
        e.preventDefault();
        getFiles(); // เรียกใช้ฟังก์ชัน getFiles เมื่อส่งฟอร์ม
        
        fetch(scriptURL, { method: 'POST', body: new FormData(form) })
        .then(response => {
            Swal.fire({
                position: "center",
                icon: "success",
                title: "บันทึกข้อมูลเรียบร้อยแล้ว",
                showConfirmButton: false,
                timer: 1500
            });
        })
        .catch(error => console.error('Error!', error.message));
    });

    function getFiles() {
        const f = document.getElementById('files');
        const name = document.getElementById('ชื่อหน่วยงาน').value;
        const folderName = `${name}_${new Date().toISOString().split('T')[0]}`; // ตั้งชื่อโฟลเดอร์ตามชื่อและวันที่
        google.script.run.withSuccessHandler(folderId => {
            [...f.files].forEach((file, i) => {
                const fr = new FileReader();
                fr.onload = (e) => {
                    const data = e.target.result.split(",");
                    const obj = {
                        fileName: f.files[i].name,
                        mimeType: data[0].match(/:(\w.+);/)[1],
                        data: data[1],
                        folderId: folderId // ส่ง ID ของโฟลเดอร์ที่สร้างขึ้น
                    };
                    google.script.run.saveFile(obj); // บันทึกไฟล์ในโฟลเดอร์ที่กำหนด
                };
                fr.readAsDataURL(file);
            });
            alert("upload เรียบร้อยแล้ว");
        }).createFolder(folderName); // สร้างโฟลเดอร์ก่อน
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</html>





<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</html>